@{
    Layout = "_PanelLayout";
}
<style>
    #map {
        height: 500px;
    }
</style>

<div id="map"></div>
@*<button id="btn">listele</button>*@

<div class="modal fade" id="getCircle" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="locationName">Location Name</label>
                            <input class="form-conrol" id="locationName" placeholder="Enter a location name" type="text"/>
                        </div>

                        <div class="col-md-6">
                            <label for="locationRadius">Radius</label>
                            <input class="form-conrol" id="locationRadius" type="text" />
                        </div>
                        <div>
                            <label>Car on this point</label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                        data-dismiss="modal">
                    Close
                </button>
                <button type="button" class="btn btn-primary">Save changes</button>
            </div>
        </div>
    </div>
</div>


@section pageJs{

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAnqSEVlrvgHJymL-F8GmxIwNbe8fYUjdg&libraries=places&callback=initMap"></script>
    <script>
        let map, circle, placesService;
        let infoWindow = new google.maps.InfoWindow();

        function initMap() {
            // Harita oluştur
            map = new google.maps.Map(document.getElementById("map"), {
                center: @ViewBag.Location,
                zoom: 13,
            });

            // Haritaya tıklanınca daire ekle
            map.addListener("click", addCircle);
            // Butona tıklanınca daire içindeki yerleri listele
            document.getElementById("btn").addEventListener("click", listPlaces);
        }

        // Daire ekleme işlemi
        function addCircle(event) {

            $('#getCircle').modal()
            // Daha önce oluşturulmuş daire varsa sil
            if (circle) {
                circle.setMap(null);
            }

            // Yeni daire oluştur
            circle = new google.maps.Circle({
                center: event.latLng,
                radius: 500,
                map: map,
                //draggable: true,
                //editable: true,
            });

            // Daire üzerine tıklandığında bilgileri göster
            circle.addListener("click", showInfo);

            // Daire boyutu veya konumu değiştirildiğinde bilgileri güncelle
            circle.addListener("radius_changed", showInfo);
            circle.addListener("center_changed", showInfo);
        }

        // Daire hakkındaki bilgileri gösterme işlemi
        function showInfo() {
            const radius = circle.getRadius() / 1000;
            const center = circle.getCenter().toJSON();
            infoWindow.setContent(`<div>Merkez: ${JSON.stringify(center)}, Yarıçap: ${radius.toFixed(2)} km</div>`);
            infoWindow.setPosition(circle.getCenter());
            infoWindow.open(map);
        }

        // Daire içindeki yerleri listeleme işlemi
        function listPlaces() {
            // PlacesService oluştur
            placesService = new google.maps.places.PlacesService(map);

            const request = {
                location: circle.getCenter(),
                radius: circle.getRadius(),
            };

            placesService.nearbySearch(request, (results, status) => {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    console.log(JSON.stringify(results));
                }
            });
        }

        window.onload = ()=>{
            initMap();
        }
    </script>
}